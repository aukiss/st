<!doctype html>
<html lang="zh-CN"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>å…­å¹´çº§å­¦ä¹ å°ç»„ Â· å›ºå®šè´¦å·ç™»å½•</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>
<header><h1>å­¦ä¹ é¦–é¡µ</h1><nav class="top-actions">
  <a class="button" href="/board.html">ğŸ† æŸ¥çœ‹æ’è¡Œæ¦œ</a>
</nav></header>
<main>
<div class="card" style="max-width:520px;margin:2vh auto">
  <h2>è´¦å·ç™»å½•</h2>
  <div class="hint">ğŸ”’ è¯·ä½¿ç”¨è€å¸ˆåˆ†é…çš„<span class="pill">è´¦å·</span>å’Œ<span class="pill">å¯†ç </span>ç™»å½•ã€‚</div>
  <label>ğŸ“ æ‰‹æœºå·</label>
  <input id="phone" type="tel" placeholder="è¯·è¾“å…¥è´¦å·" inputmode="numeric" pattern="\d{6,}"/>
  <label>ğŸ”’ å¯†ç </label>
  <input id="password" type="password" placeholder="è¾“å…¥å¯†ç " autocomplete="current-password"/>
  <div class="top-actions" style="margin-top:8px"><button id="login">ç™»å½• ğŸš€</button></div>
  <p class="muted">@å‡‰é£æœ‰ä¿¡</p>
  <p class="muted" id="tip"></p>
</div>
</main>
<script>
function toast(msg, kind){const t=document.createElement('div');t.className='toast';t.textContent = (kind==='ok'?'âœ… ':'') + (kind==='warn'?'âš ï¸ ':'') + (kind==='err'?'âŒ ':'') + msg; if(kind==='ok') t.style.background='#16a34a'; if(kind==='warn') t.style.background='#f59e0b'; if(kind==='err') t.style.background='#dc2626'; document.body.appendChild(t); setTimeout(()=>{ t.style.opacity='0'; t.style.transition='opacity .3s'; setTimeout(()=>t.remove(),320); }, 1800);}
async function post(u,b){const r=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});const t=await r.json().catch(()=>({}));if(!r.ok)throw new Error(t.message||("HTTP "+r.status));return t;}
function normPhone(p){return (p||"").replace(/\D+/g,"");}
document.getElementById('login').onclick=async(e)=>{
  const btn=e.target;
  const phone=normPhone(document.getElementById('phone').value);
  const password=document.getElementById('password').value;
  if(!phone||password.length<4){toast("è¯·å¡«å†™è´¦å·å’Œå¯†ç ","warn");return;}
  btn.disabled=true; const old=btn.textContent; btn.textContent='ç™»å½•ä¸­â€¦';
  try{
    const me = await post("/.netlify/functions/auth_login",{phone,password});
    sessionStorage.setItem("me", JSON.stringify(me));
    location.href = me.role==="teacher" ? "/teacher.html" : "/student.html";
  }catch(e){toast(e.message,'err');}
  finally{btn.disabled=false; btn.textContent=old;}
};
</script>
</body></html>
